{% extends "travel/travel_base.html" %}
{% load static %}
{% load bootstrap4 %}
{% load i18n %}
{% block header %}
{% endblock %}
{% block content %}


    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'travel:index' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'travel:trip_list' %}">Trips</a></li>
            {% if object %}
                <li class="breadcrumb-item"><a href="{% url 'travel:trip_detail' object.id %}">{{ object }}</a></li>
                <li class="breadcrumb-item active" aria-current="page">Edit</li>
            {% else %}
                <li class="breadcrumb-item active" aria-current="page">New</li>
            {% endif %}
        </ol>
    </nav>

    <div class="container">

        <h1>
            {% if object %}
                {% if cloned %}
                    CLONING:
                {% endif %}
                {{ object }}
            {% else %}
                New Trip
            {% endif %}
        </h1>

        <br>

        <form method="post" class="form">
            {% csrf_token %}
            {% bootstrap_form_errors form %}
            {% for field in form %}
                {% if "hide-me" in field.field.widget.attrs.class %}
                    <div class="hide-me">
                {% endif %}

            {% if field.name == "conference" %}
                <div class="conference_container">
                    {% bootstrap_field field placeholder="" %}
                    (<a href="#" pop-href="{% url 'travel:conf_new' 1 %}" id="new_event">add a new event</a>)
                    <br><br>
                </div>
            {% elif field.name == "is_group_trip" %}
                {% bootstrap_field field placeholder="" %}
                <div class="show-me blue-font">
                    <p>
                        <em>
                            {% trans "(One this form is submitted, you will be able to add group travellers to the trip. You will be automatically added as a traveller.)" %}
                        </em>
                    </p>
                </div>
            {% elif field.name == "role" %}
                <div class="conference_container">
                    {% bootstrap_field field placeholder="" %}
                </div>
            {% elif field.name == "role_of_participant" %}
                <div class="conference_container">
                    {% bootstrap_field field placeholder="" %}
                </div>
            {% elif field.name == "event_lead" %}
                <div class="event_container">
                    {% bootstrap_field field placeholder="" %}
                </div>
            {% else %}

                {% bootstrap_field field placeholder="" %}
            {% endif %}
            {% if "hide-me" in field.field.widget.attrs.class %}
                </div>
            {% endif %}
            {% endfor %}



            {% buttons %}
                {% if object %}
                    <button type="submit" class="btn btn-success">Submit</button>
                    <a class="btn btn-secondary" href="{% url 'travel:trip_detail' object.id %}">Cancel</a>
                {% else %}
                    <button type="submit" class="btn btn-success">Add</button>
                    <a class="btn btn-secondary" href="{% url 'travel:trip_list' %}">Cancel</a>
                {% endif %}


            {% endbuttons %}
        </form>

    </div>
{% endblock content %}

{% block body_js %}

    <script type="application/javascript">
        var userObj = {{ user_json|safe }};
        {#var sectionObj = {{ section_json|safe }};#}
        var myId = "";

        function refreshUserInfo() {
            myId = $("#id_user").val();
            $("#id_first_name").val(userObj[myId]["first_name"]);
            $("#id_last_name").val(userObj[myId]["last_name"]);
            $("#id_email").val(userObj[myId]["email"]);
        }

        function refreshConference() {
            if ($("#id_is_conference").val() == "False") {
                $("#id_conference").val("").prop("disabled", true);
                $("#id_role").val("").prop("disabled", true);
                $("#id_role_of_participant").val("").prop("disabled", true);
                $(".conference_container").addClass("gone");
            } else {
                $("#id_conference").prop("disabled", false);
                $("#id_role").prop("disabled", false);
                $("#id_role_of_participant").prop("disabled", false);
                $(".conference_container").removeClass("gone");
            }
        }

        function refreshEvent() {
            if ($("#id_has_event_template").val() == "false") {
                $("#id_event_lead").val("").prop("disabled", true);
                $(".event_container").addClass("gone");
            } else {
                $("#id_event_lead").prop("disabled", false);
                $(".event_container").removeClass("gone");
            }
        }

        function refreshClassHideMe() {
            if ($("#id_is_group_trip").val() == "False") {
                $(".hide-me").removeClass("gone");
                $(".show-me").addClass("gone");
            } else {
                $(".hide-me").addClass("gone");
                $(".show-me").removeClass("gone");
            }
        }

        $("#id_user").change(function () {
            refreshUserInfo();
        });

        $("#id_has_event_template").change(function () {
            refreshEvent();
        });

        $("#id_is_conference").change(function () {
            refreshConference();
        });

        $("#id_is_group_trip").change(function () {
            refreshClassHideMe();
        });

        $(document).ready(function () {
            // Stuff to do as soon as the DOM is ready
            refreshUserInfo();
            refreshConference();
            refreshEvent();
            refreshClassHideMe();
            // do not make these fields required, otherwise we will not see the form errors if omitted
            $("#id_user").prop("required", false);
            $("#id_section").prop("required", false);
        });

        $("#new_event").click(function () {
            $("#id_stay_on_page").val(1);
            $("form").submit();
        })

    </script>
{% endblock %}


