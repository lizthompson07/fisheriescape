{% load verbose_names %}
{% load bootstrap4 %}
{% load humanize %}
{% load custom_filters %}
{% load i18n %}

{% bootstrap_css %}

<h1>{{ object }} ({{ object.id }})
    {#    ({{ object.id }})#}
    {% if not object_list %}
        -
        {% if object.submitted %}
            {% trans "SUBMITTED" %}
        {% else %}
            <span class="red-font">
                {% trans "UNSUBMITTED" %}
                </span>
        {% endif %}
    {% endif %}

</h1>

<hr>
<br>
<table class="table table-sm table-striped" style="width: auto">
    {# cheating here to adjust header width #}

    {% for field in field_list %}
        {% if field == "programs" %}
            <tr>
                <th>{% get_verbose_label object field %}</th>
                <td>
                {% if object.programs.count > 0 %}
                    {% get_field_value object field %}
                {% else %}
                    <span class="red-font blink-me">{% trans "MISSING PROGRAM INFORMATION" %}</span>
                {% endif %}
                </td>
            </tr>
        {% else %}
            {% verbose_td_display object field th_width="30%" td_width="80%" %}
        {% endif %}
    {% endfor %}
    {% verbose_td_display object "section_head_approved" %}
    {% verbose_td_display object "section_head_feedback" %}
    {% verbose_td_display object "manager_approved" %}
    {% verbose_td_display object "manager_feedback" %}
    {% verbose_td_display object "rds_approved" %}
    {% verbose_td_display object "rds_feedback" %}
</table>
<hr>

{% include "projects/_staff.html" %}
{% include "projects/_om_costs.html" %}
{% include "projects/_capital_costs.html" %}
{% include "projects/_gc_costs.html" %}
{% include "projects/_collaborators.html" %}
{% include "projects/_agreements.html" %}
{% include "projects/_milestones.html" %}
{% if object_list %}
    {% with financial_summary_data|lookup:object.id|lookup:"salary_abase" as salary_abase %}
        {% with financial_summary_data|lookup:object.id|lookup:"salary_bbase" as salary_bbase %}
            {% with financial_summary_data|lookup:object.id|lookup:"salary_cbase" as salary_cbase %}
                {% with financial_summary_data|lookup:object.id|lookup:"salary_total" as salary_total %}
                    {% with financial_summary_data|lookup:object.id|lookup:"om_abase" as om_abase %}
                        {% with financial_summary_data|lookup:object.id|lookup:"om_bbase" as om_bbase %}
                            {% with financial_summary_data|lookup:object.id|lookup:"om_cbase" as om_cbase %}
                                {% with financial_summary_data|lookup:object.id|lookup:"om_total" as om_total %}
                                    {% with financial_summary_data|lookup:object.id|lookup:"capital_abase" as capital_abase %}
                                        {% with financial_summary_data|lookup:object.id|lookup:"capital_bbase" as capital_bbase %}
                                            {% with financial_summary_data|lookup:object.id|lookup:"capital_cbase" as capital_cbase %}
                                                {% with financial_summary_data|lookup:object.id|lookup:"capital_total" as capital_total %}
                                                    {% with financial_summary_data|lookup:object.id|lookup:"abase" as abase %}
                                                        {% with financial_summary_data|lookup:object.id|lookup:"bbase" as bbase %}
                                                            {% with financial_summary_data|lookup:object.id|lookup:"cbase" as cbase %}
                                                                {% include "projects/_financial.html" %}
                                                            {% endwith %}
                                                        {% endwith %}
                                                    {% endwith %}
                                                {% endwith %}
                                            {% endwith %}
                                        {% endwith %}
                                    {% endwith %}
                                {% endwith %}
                            {% endwith %}
                        {% endwith %}
                    {% endwith %}
                {% endwith %}
            {% endwith %}
        {% endwith %}
    {% endwith %}

{% else %}
    {% include "projects/_financial.html" %}
{% endif %}

